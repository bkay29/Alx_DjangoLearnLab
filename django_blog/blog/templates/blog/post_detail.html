{% extends 'base.html' %}

{% block title %}{{ object.title }} | Django Blog{% endblock %}

{% block content %}
<article class="post-detail">
    <h1>{{ object.title }}</h1>
    <p><strong>By:</strong> {{ object.author.username }} | 
       <strong>Posted:</strong> {{ object.published_date|date:"M d, Y H:i" }}</p>
    <div class="post-body">
        {{ object.content|linebreaks }}
    </div>

    {% if user.is_authenticated and user == object.author %}
        <div class="actions">
            <a href="{% url 'post-update' object.pk %}" class="btn">Edit</a>
            <a href="{% url 'post-delete' object.pk %}" class="btn danger">Delete</a>
        </div>
    {% endif %}
</article>

<!-- ========== Comments section ========== -->
<section class="comments" style="margin-top:2em;">
  <h2>Comments</h2>

  {% comment %}
    Use object.comments.all() thanks to related_name='comments' on Comment.post
  {% endcomment %}
  {% if object.comments.exists %}
    {% for comment in object.comments.all %}
      <div class="comment" style="border-bottom:1px solid #e6e6e6; padding:0.75em 0;">
        <p style="margin:0;">
          <strong>{{ comment.author.username }}</strong>
          <small> — {{ comment.created_at|date:"M d, Y H:i" }}</small>
        </p>
        <p style="margin:0.5em 0;">{{ comment.content|linebreaksbr }}</p>

        {% if user.is_authenticated and comment.author == user %}
          <p style="margin-top:0.5em;">
            <a href="{% url 'comment-edit' pk=comment.pk %}">Edit</a> |
            <a href="{% url 'comment-delete' pk=comment.pk %}">Delete</a>
          </p>
        {% endif %}
      </div>
    {% endfor %}
  {% else %}
    <p>No comments yet — be the first to comment!</p>
  {% endif %}

  <div class="add-comment" style="margin-top:1.25em;">
    {% if user.is_authenticated %}
      <h3>Add a comment</h3>
      <form method="post" action="{% url 'comment-create' post_id=object.pk %}">
        {% csrf_token %}
        <div>
          <label for="id_content">Comment</label><br>
          <textarea name="content" id="id_content" rows="3" placeholder="Write your comment..." required minlength="3" maxlength="1000" style="width:100%;"></textarea>
        </div>
        <div style="margin-top:0.5em;">
          <button type="submit" class="btn">Post Comment</button>
        </div>
      </form>
    {% else %}
      <p><a href="{% url 'login' %}?next={{ request.path }}">Log in</a> to post a comment.</p>
    {% endif %}
  </div>
</section>
<!-- ========== End comments section ========== -->

<p style="margin-top:1.5em;"><a href="{% url 'post-list' %}">&larr; Back to Posts</a></p>
{% endblock %}

